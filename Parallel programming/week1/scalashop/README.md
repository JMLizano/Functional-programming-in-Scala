<div data-reactroot="" class="rc-CML styled"><div><p></p><p><strong>Note: If you have paid for the Certificate, please make sure you are submitting to the required assessment and not the optional assessment. If you mistakenly use the token from the wrong assignment, your grades will not appear</strong></p><p></p><h1>Parallel Box Blur Filter</h1><p>You will find the starting files <a href="http://alaska.epfl.ch/~dockermoocs/parprog1/scalashop.zip" target="_blank" rel="noopener nofollow">here</a>.</p><p>In this assignment, we will implement a box blur filter, used in applications like Adobe® PhotoShop® to blur images. For the purposes of this assignment, a filter is an algorithm that takes an input image and transforms it in some way into an output image. The box blur filter outputs an image in which every pixel has an average value of the surrounding pixels from the original image. The box blur filter is an example of an <em>embarrassingly parallel</em> problem -- no or very little effort is required to separate it into parallel tasks. Every pixel of the output image can be computed independently of the other pixels, and in parallel.</p><p>We will proceed in four steps. First, we will implement the kernel of the box blur filter, a method used to compute a single pixel of the output image. Then we will implement two versions of the parallel box blur, and measure the performance difference. Finally, we will try out our parallel box blur implementations on real images, using ScalaShop -- the image manipulation tool that would impress even the Adobe® folks.</p><p>By the time you are finished with this assignment, you will:</p><ul><li>understand how the box blur filter works</li><li>be able to recognize embarrassingly parallel problems</li><li>know how to measure the performance of a parallel algorithm</li><li>see how to agglomerate parallel computations into batches</li><li>better understand how memory access patterns affect performance of parallel algorithms</li></ul><h2>Preliminaries</h2><p>Before we begin, we need to cover some basic data types and helper methods. These utilities have already been implemented in the package object for this exercise. First, we will use the <strong>RGBA</strong> type to refer to the value of an image pixel. We will limit ourselves to 32-bit pixel depth images, so we define <strong>RGBA</strong> to be equal to the 32-bit integer type:</p><pre contenteditable="false" data-language="scala" tabindex="0" style="opacity: 1;"><div data-reactroot="" class="rc-CodeBlock ace_editor ace-tomorrow" style="height: 50px;"><textarea class="ace_text-input" wrap="off" autocorrect="off" autocapitalize="off" spellcheck="false" style="opacity: 0; left: 154.019px; top: 0px; height: 16px; width: 7.20125px;" role="presentation" aria-hidden="true" tabindex="-1"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled" style="margin-top: 0px; height: 80px; width: 41px;"><div class="ace_gutter-cell " style="height: 16px;">1</div></div><div class="ace_gutter-active-line" style="top: 0px; height: 16px;"></div></div><div class="ace_scroller" style="left: 42px; right: 0px; bottom: 0px;"><div class="ace_content" style="margin-top: 0px; width: 482px; height: 80px; margin-left: 0px;"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 580.1px; visibility: visible;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword">type</span> <span class="ace_identifier">RGBA</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_support ace_function">Int</span></div></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor" style="left: 112.019px; top: 0px; width: 7.20125px; height: 16px;"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 17px; bottom: 0px;"><div class="ace_scrollbar-inner" style="width: 17px; height: 16px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 17px; left: 42px; right: 0px;"><div class="ace_scrollbar-inner" style="height: 17px; width: 482px;"></div></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div></pre><p>Why do we call this type <strong>RGBA</strong>? This is because each pixel value is composed from 4 components - red, green, blue and alpha, where alpha denotes the amount of transparency in the respective pixel. These components are referred to as <em>channels</em>. The value of each channel is at least 0 and at most 255.</p><p>We can extract the red, green, blue and alpha channel using the following utility methods, which use bit masking and bit shifting:</p><pre contenteditable="false" data-language="scala" tabindex="0" style="opacity: 1;"><div data-reactroot="" class="rc-CodeBlock ace_editor ace-tomorrow" style="height: 66px;"><textarea class="ace_text-input" wrap="off" autocorrect="off" autocapitalize="off" spellcheck="false" style="opacity: 0; left: 391.66px; top: 48px; height: 16px; width: 7.20125px;" role="presentation" aria-hidden="true" tabindex="-1"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled" style="margin-top: 0px; height: 96px; width: 41px;"><div class="ace_gutter-cell " style="height: 16px;">1</div><div class="ace_gutter-cell " style="height: 16px;">2</div><div class="ace_gutter-cell " style="height: 16px;">3</div><div class="ace_gutter-cell " style="height: 16px;">4</div></div><div class="ace_gutter-active-line" style="top: 48px; height: 16px;"></div></div><div class="ace_scroller" style="left: 42px; right: 0px; bottom: 0px;"><div class="ace_content" style="margin-top: 0px; width: 482px; height: 96px; margin-left: 0px;"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 580.1px; visibility: visible;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword">def</span> <span class="ace_identifier">red</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">c</span>: <span class="ace_identifier">RGBA</span><span class="ace_paren ace_rparen">)</span>: <span class="ace_support ace_function">Int</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">0xff000000</span> <span class="ace_keyword ace_operator">&amp;</span> <span class="ace_identifier">c</span><span class="ace_paren ace_rparen">)</span> <span class="ace_keyword ace_operator">&gt;&gt;&gt;</span> <span class="ace_constant ace_numeric">24</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword">def</span> <span class="ace_identifier">green</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">c</span>: <span class="ace_identifier">RGBA</span><span class="ace_paren ace_rparen">)</span>: <span class="ace_support ace_function">Int</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">0x00ff0000</span> <span class="ace_keyword ace_operator">&amp;</span> <span class="ace_identifier">c</span><span class="ace_paren ace_rparen">)</span> <span class="ace_keyword ace_operator">&gt;&gt;&gt;</span> <span class="ace_constant ace_numeric">16</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword">def</span> <span class="ace_identifier">blue</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">c</span>: <span class="ace_identifier">RGBA</span><span class="ace_paren ace_rparen">)</span>: <span class="ace_support ace_function">Int</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">0x0000ff00</span> <span class="ace_keyword ace_operator">&amp;</span> <span class="ace_identifier">c</span><span class="ace_paren ace_rparen">)</span> <span class="ace_keyword ace_operator">&gt;&gt;&gt;</span> <span class="ace_constant ace_numeric">8</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword">def</span> <span class="ace_identifier">alpha</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">c</span>: <span class="ace_identifier">RGBA</span><span class="ace_paren ace_rparen">)</span>: <span class="ace_support ace_function">Int</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">0x000000ff</span> <span class="ace_keyword ace_operator">&amp;</span> <span class="ace_identifier">c</span><span class="ace_paren ace_rparen">)</span> <span class="ace_keyword ace_operator">&gt;&gt;&gt;</span> <span class="ace_constant ace_numeric">0</span></div></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor" style="left: 349.66px; top: 48px; width: 7.20125px; height: 16px;"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 17px; bottom: 0px;"><div class="ace_scrollbar-inner" style="width: 17px; height: 64px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 17px; left: 42px; right: 0px;"><div class="ace_scrollbar-inner" style="height: 17px; width: 482px;"></div></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div></pre><p>Similarly, given the values of the four channels, we can obtain the pixel value like this:</p><pre contenteditable="false" data-language="scala" tabindex="0" style="opacity: 1;"><div data-reactroot="" class="rc-CodeBlock ace_editor ace-tomorrow" style="height: 50px;"><textarea class="ace_text-input" wrap="off" autocorrect="off" autocapitalize="off" spellcheck="false" style="opacity: 0; left: 370.056px; top: 16px; height: 16px; width: 7.20125px;" role="presentation" aria-hidden="true" tabindex="-1"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled" style="margin-top: 0px; height: 80px; width: 41px;"><div class="ace_gutter-cell " style="height: 16px;">1</div><div class="ace_gutter-cell " style="height: 16px;">2</div></div><div class="ace_gutter-active-line" style="top: 16px; height: 16px;"></div></div><div class="ace_scroller" style="left: 42px; right: 0px; bottom: 0px;"><div class="ace_content" style="margin-top: 0px; width: 482px; height: 80px; margin-left: 0px;"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 580.1px; visibility: visible;"></div></div><div class="ace_layer ace_marker-layer"><div class="ace_bracket ace_start ace_br15" style="height:16px;width:7.20125px;top:16px;left:270.44625px;"></div></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword">def</span> <span class="ace_identifier">rgba</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">r</span>: <span class="ace_support ace_function">Int</span>, <span class="ace_identifier">g</span>: <span class="ace_support ace_function">Int</span>, <span class="ace_identifier">b</span>: <span class="ace_support ace_function">Int</span>, <span class="ace_identifier">a</span>: <span class="ace_support ace_function">Int</span><span class="ace_paren ace_rparen">)</span>: <span class="ace_identifier">RGBA</span> <span class="ace_keyword ace_operator">=</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">  <span class="ace_paren ace_lparen">(</span><span class="ace_identifier">r</span> <span class="ace_keyword ace_operator">&lt;&lt;</span> <span class="ace_constant ace_numeric">24</span><span class="ace_paren ace_rparen">)</span> | <span class="ace_paren ace_lparen">(</span><span class="ace_identifier">g</span> <span class="ace_keyword ace_operator">&lt;&lt;</span> <span class="ace_constant ace_numeric">16</span><span class="ace_paren ace_rparen">)</span> | <span class="ace_paren ace_lparen">(</span><span class="ace_identifier">b</span> <span class="ace_keyword ace_operator">&lt;&lt;</span> <span class="ace_constant ace_numeric">8</span><span class="ace_paren ace_rparen">)</span> | <span class="ace_paren ace_lparen">(</span><span class="ace_identifier">a</span> <span class="ace_keyword ace_operator">&lt;&lt;</span> <span class="ace_constant ace_numeric">0</span><span class="ace_paren ace_rparen">)</span></div></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor" style="left: 328.056px; top: 16px; width: 7.20125px; height: 16px;"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 17px; bottom: 0px;"><div class="ace_scrollbar-inner" style="width: 17px; height: 32px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 17px; left: 42px; right: 0px;"><div class="ace_scrollbar-inner" style="height: 17px; width: 482px;"></div></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div></pre><p>Now that we know how to manipulate individual pixels, we can define our image type<strong> Img</strong>:</p><pre contenteditable="false" data-language="scala" tabindex="0" style="opacity: 1;"><div data-reactroot="" class="rc-CodeBlock ace_editor ace-tomorrow" style="height: 98px;"><textarea class="ace_text-input" wrap="off" autocorrect="off" autocapitalize="off" spellcheck="false" style="opacity: 0; left: 53.2013px; top: 80px; height: 16px; width: 7.20125px;" role="presentation" aria-hidden="true" tabindex="-1"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled" style="margin-top: 0px; height: 128px; width: 41px;"><div class="ace_gutter-cell " style="height: 16px;">1<span class="ace_fold-widget ace_start ace_open" style="height: 16px;"></span></div><div class="ace_gutter-cell " style="height: 16px;">2</div><div class="ace_gutter-cell " style="height: 16px;">3</div><div class="ace_gutter-cell " style="height: 32px;">4</div><div class="ace_gutter-cell " style="height: 16px;">5</div></div><div class="ace_gutter-active-line" style="top: 80px; height: 16px;"></div></div><div class="ace_scroller" style="left: 42px; right: 0px; bottom: 0px;"><div class="ace_content" style="margin-top: 0px; width: 482px; height: 128px; margin-left: 0px;"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 580.1px; visibility: visible;"></div></div><div class="ace_layer ace_marker-layer"><div class="ace_bracket ace_start ace_br15" style="height:16px;width:7.20125px;top:0px;left:313.65375px;"></div></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword">class</span> <span class="ace_identifier">Img</span><span class="ace_paren ace_lparen">(</span><span class="ace_keyword">val</span> <span class="ace_identifier">width</span>: <span class="ace_support ace_function">Int</span>, <span class="ace_keyword">val</span> <span class="ace_identifier">height</span>: <span class="ace_support ace_function">Int</span><span class="ace_paren ace_rparen">)</span> <span class="ace_paren ace_lparen">{</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">  <span class="ace_keyword">private</span> <span class="ace_keyword">val</span> <span class="ace_identifier">data</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_keyword">new</span> <span class="ace_support ace_function">Array</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">RGBA</span><span class="ace_paren ace_rparen">]</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">width</span> <span class="ace_keyword ace_operator">*</span> <span class="ace_identifier">height</span><span class="ace_paren ace_rparen">)</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">  <span class="ace_keyword">def</span> <span class="ace_identifier">apply</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">x</span>: <span class="ace_support ace_function">Int</span>, <span class="ace_identifier">y</span>: <span class="ace_support ace_function">Int</span><span class="ace_paren ace_rparen">)</span>: <span class="ace_identifier">RGBA</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">data</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">y</span> <span class="ace_keyword ace_operator">*</span> <span class="ace_identifier">width</span> <span class="ace_keyword ace_operator">+</span> <span class="ace_identifier">x</span><span class="ace_paren ace_rparen">)</span></div></div><div class="ace_line_group" style="height:32px"><div class="ace_line" style="height:16px">  <span class="ace_keyword">def</span> <span class="ace_identifier">update</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">x</span>: <span class="ace_support ace_function">Int</span>, <span class="ace_identifier">y</span>: <span class="ace_support ace_function">Int</span>, <span class="ace_identifier">c</span>: <span class="ace_identifier">RGBA</span><span class="ace_paren ace_rparen">)</span>: <span class="ace_support ace_function">Unit</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">data</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">y</span> <span class="ace_keyword ace_operator">*</span> <span class="ace_identifier">width</span> <span class="ace_keyword ace_operator">+</span> <span class="ace_identifier">x</span><span class="ace_paren ace_rparen">)</span> </div><div class="ace_line" style="height:16px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">c</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_paren ace_rparen">}</span></div></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor" style="left: 11.2012px; top: 80px; width: 7.20125px; height: 16px;"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 17px; bottom: 0px;"><div class="ace_scrollbar-inner" style="width: 17px; height: 96px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 17px; left: 42px; right: 0px;"><div class="ace_scrollbar-inner" style="height: 17px; width: 482px;"></div></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div></pre><p>The image is a two-dimensional entity -- to refer to a pixel in an image, we need to specify an<strong> x</strong> and<strong> y</strong> component. On the other hand, the underlying memory model is one-dimensional -- a single offset value specifies the position in the array. When we store the image into memory, we need to map between the two-dimensional image model and the one-dimensional memory model. We will do this by storing consecutive rows of the image one after another, as illustrated in the following figure:</p><figure><img src="https://d3c33hcgiwev3.cloudfront.net/imageAssetProxy.v1/I_dgdNDEEeWbSgqxBCBhEw_1e046aae85df7345cceba4b9ceca2252_mapping.png?expiry=1538524800000&amp;hmac=5tjabAvKCdb9ZIssB_wGPXy_NJsHyuLqBNHVzrEaGbQ" alt="" data-asset-id="I_dgdNDEEeWbSgqxBCBhEw"></figure><p></p><p>Thus, the offset of a pixel at coordinates <strong>x</strong> and <strong>y</strong>, is equal to <strong>y * width + x</strong>, where <strong>width</strong> is the number of pixels in a single row. Although there are other mappings used in practice, we will restrict to this simple mapping throughout the exercise.</p><p>To ensure that the value of the <strong>x</strong> and <strong>y</strong> coordinates are confined to the dimensions of the image, namely width and height, occasionally we have to call the <strong>clamp</strong> method:</p><pre contenteditable="false" data-language="scala" tabindex="0" style="opacity: 1;"><div data-reactroot="" class="rc-CodeBlock ace_editor ace-tomorrow" style="height: 50px;"><textarea class="ace_text-input" wrap="off" autocorrect="off" autocapitalize="off" spellcheck="false" style="opacity: 0; left: 348.452px; top: 0px; height: 16px; width: 7.20125px;" role="presentation" aria-hidden="true" tabindex="-1"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled" style="margin-top: 0px; height: 80px; width: 41px;"><div class="ace_gutter-cell " style="height: 16px;">1</div></div><div class="ace_gutter-active-line" style="top: 0px; height: 16px;"></div></div><div class="ace_scroller" style="left: 42px; right: 0px; bottom: 0px;"><div class="ace_content" style="margin-top: 0px; width: 482px; height: 80px; margin-left: 0px;"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 580.1px; visibility: visible;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword">def</span> <span class="ace_identifier">clamp</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">v</span>: <span class="ace_support ace_function">Int</span>, <span class="ace_identifier">min</span>: <span class="ace_support ace_function">Int</span>, <span class="ace_identifier">max</span>: <span class="ace_support ace_function">Int</span><span class="ace_paren ace_rparen">)</span>: <span class="ace_support ace_function">Int</span></div></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor" style="left: 306.452px; top: 0px; width: 7.20125px; height: 16px;"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 17px; bottom: 0px;"><div class="ace_scrollbar-inner" style="width: 17px; height: 16px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 17px; left: 42px; right: 0px;"><div class="ace_scrollbar-inner" style="height: 17px; width: 482px;"></div></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div></pre><p>Finally, we will use the <strong>task</strong> construct to start parallel computations. Every <strong>task</strong> construct invocation returns an object on which we can call the<strong> join</strong> method. Calling the join method blocks the execution of the program until the parallel computation ends. Below, we calculate the expression<strong> 1 + 1</strong> in parallel to the main program:</p><pre contenteditable="false" data-language="scala" tabindex="0" style="opacity: 1;"><div data-reactroot="" class="rc-CodeBlock ace_editor ace-tomorrow" style="height: 114px;"><textarea class="ace_text-input" wrap="off" autocorrect="off" autocapitalize="off" spellcheck="false" style="opacity: 0; left: 175.623px; top: 96px; height: 16px; width: 7.20125px;" role="presentation" aria-hidden="true" tabindex="-1"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled" style="margin-top: 0px; height: 144px; width: 41px;"><div class="ace_gutter-cell " style="height: 16px;">1<span class="ace_fold-widget ace_start ace_open" style="height: 16px;"></span></div><div class="ace_gutter-cell " style="height: 16px;">2</div><div class="ace_gutter-cell " style="height: 16px;">3</div><div class="ace_gutter-cell " style="height: 16px;">4</div><div class="ace_gutter-cell " style="height: 16px;">5</div><div class="ace_gutter-cell " style="height: 16px;">6</div><div class="ace_gutter-cell " style="height: 16px;">7</div></div><div class="ace_gutter-active-line" style="top: 96px; height: 16px;"></div></div><div class="ace_scroller" style="left: 42px; right: 0px; bottom: 0px;"><div class="ace_content" style="margin-top: 0px; width: 482px; height: 144px; margin-left: 0px;"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 580.1px; visibility: visible;"></div></div><div class="ace_layer ace_marker-layer"><div class="ace_bracket ace_start ace_br15" style="height:16px;width:7.20125px;top:96px;left:119.22px;"></div></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword">val</span> <span class="ace_identifier">computation</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_identifier">task</span> <span class="ace_paren ace_lparen">{</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">  <span class="ace_keyword">val</span> <span class="ace_identifier">result</span> <span class="ace_keyword ace_operator">=</span> <span class="ace_constant ace_numeric">1</span> <span class="ace_keyword ace_operator">+</span> <span class="ace_constant ace_numeric">1</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">  <span class="ace_keyword">println</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">"Done!"</span><span class="ace_paren ace_rparen">)</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">  <span class="ace_identifier">result</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_paren ace_rparen">}</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword">println</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">"About to wait for some heavy calculation..."</span><span class="ace_paren ace_rparen">)</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_identifier">computation</span>.<span class="ace_identifier">join</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span></div></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor" style="left: 133.623px; top: 96px; width: 7.20125px; height: 16px;"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 17px; bottom: 0px;"><div class="ace_scrollbar-inner" style="width: 17px; height: 112px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 17px; left: 42px; right: 0px;"><div class="ace_scrollbar-inner" style="height: 17px; width: 482px;"></div></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div></pre><p>We now have everything we need to start implementing the parallel box filter.</p><h2>The Box Blur Filter Kernel</h2><p>In the first part of the assignment, we will implement the box blur filter kernel method. A kernel is a method that computes the resulting value of a single pixel. The kernel method is typically computationally cheap and is not worth parallelizing its implementation. However, as we will later see, we can apply the same kernel method to different pixels in parallel.</p><figure><img src="https://d3c33hcgiwev3.cloudfront.net/imageAssetProxy.v1/VDQpKNDEEeWsvw6jxkA2Kw_465a0220117f367e7eb20dc279ad6a4a_kernel.png?expiry=1538524800000&amp;hmac=HOz5gbCq01dFIryDeworko38bcPOkzbeRVC94ZkcYnY" alt="" data-asset-id="VDQpKNDEEeWsvw6jxkA2Kw"></figure><p>The <strong>boxBlurKernel</strong> method takes the source image<strong> src</strong>, coordinates <strong>x</strong> and <strong>y</strong> of the pixel, and the <strong>radius</strong> of the blur. It returns the resulting average value of the surrounding pixels. We compute the average value by separating the pixel into four channels, computing the average of each of the channels, and using the four average values to produce the final pixel value. In the previous figure, the <strong>radius</strong> parameter is equal to 1 and the average is computed from 9 pixels.</p><p>You can find its signature in the package object of this assignment:</p><pre contenteditable="false" data-language="scala" tabindex="0" style="opacity: 1;"><div data-reactroot="" class="rc-CodeBlock ace_editor ace-tomorrow" style="height: 50px;"><textarea class="ace_text-input" wrap="off" autocorrect="off" autocapitalize="off" spellcheck="false" style="opacity: 0; left: 474.799px; top: 0px; height: 16px; width: 7.20125px;" role="presentation" aria-hidden="true" tabindex="-1"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled" style="margin-top: 0px; height: 80px; width: 41px;"><div class="ace_gutter-cell " style="height: 16px;">1</div></div><div class="ace_gutter-active-line" style="top: 0px; height: 16px;"></div></div><div class="ace_scroller" style="left: 42px; right: 0px; bottom: 0px;"><div class="ace_content" style="margin-top: 0px; width: 482px; height: 80px; margin-left: 0px;"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 580.1px; visibility: visible;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword">def</span> <span class="ace_identifier">boxBlurKernel</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">src</span>: <span class="ace_identifier">Img</span>, <span class="ace_identifier">x</span>: <span class="ace_support ace_function">Int</span>, <span class="ace_identifier">y</span>: <span class="ace_support ace_function">Int</span>, <span class="ace_identifier">radius</span>: <span class="ace_support ace_function">Int</span><span class="ace_paren ace_rparen">)</span>: <span class="ace_identifier">RGBA</span></div></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor" style="left: 450.478px; top: 0px; width: 7.20125px; height: 16px;"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 17px; bottom: 0px;"><div class="ace_scrollbar-inner" style="width: 17px; height: 16px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 17px; left: 42px; right: 0px;"><div class="ace_scrollbar-inner" style="height: 17px; width: 482px;"></div></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div></pre><p>Implement the<strong> boxBlurKernel</strong> method. Use two nested <strong>while</strong>-loops. Make sure that the pixels at the image edges are affected only by the pixels inside the image (hint: use the <strong>clamp</strong> method from the package object).</p><h2>Vertical Stripping Box Blur</h2><p>We can now implement the parallel box blur filter. Note that the <strong>boxBlurKernel</strong> method is relatively inexpensive. Executing <strong>boxBlurKernel </strong>might be much faster than starting a parallel computation, so having a separate parallel computation for the value of each pixel would be far too expensive. For this reason, we want to batch together many <strong>boxBlurKernel</strong> calls, and have a smaller number of parallel tasks. This is sometimes referred to as <em>agglomeration</em>, and is present in many parallel algorithm implementations.</p><p>There are many different ways we can do agglomeration for the parallel box blur. One is to divide the image into a fixed number of equally wide vertical strips. For each strip, we start a parallel task, and wait for their completion. Within each strip, we traverse the pixels going from the top to the bottom of the image, as illustrated in the following figure:</p><figure><img src="https://d3c33hcgiwev3.cloudfront.net/imageAssetProxy.v1/j9hpZdDEEeWbSgqxBCBhEw_53b255bc9b723c2aa5072511c646b92d_vertical.png?expiry=1538524800000&amp;hmac=VDY7IIeJ7OCFXQu5YOkplPOisk-DBMCErXtQ5Kbn_ow" alt="" data-asset-id="j9hpZdDEEeWbSgqxBCBhEw"></figure><p>We start by implementing the sequential<strong> blur</strong> method in the <strong>VerticalBoxBlur.scala</strong> source file, which takes the source image <strong>src</strong>, the destination image <strong>dst</strong>, the starting (included) and ending (excluded)<strong> x</strong> coordinates (i.e, column indices) of the strip, called <strong>from</strong> and <strong>end</strong>, and the blur <strong>radius</strong>. The <strong>blur</strong> method blurs the pixels from the <strong>src</strong> image and writes them to the <strong>dst</strong> image:</p><pre contenteditable="false" data-language="scala" tabindex="0" style="opacity: 1;"><div data-reactroot="" class="rc-CodeBlock ace_editor ace-tomorrow" style="height: 50px;"><textarea class="ace_text-input" wrap="off" autocorrect="off" autocapitalize="off" spellcheck="false" style="opacity: 0; left: 103.61px; top: 16px; height: 16px; width: 7.20125px;" role="presentation" aria-hidden="true" tabindex="-1"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled" style="margin-top: 0px; height: 112px; width: 41px;"><div class="ace_gutter-cell " style="height: 32px;">1</div></div><div class="ace_gutter-active-line" style="top: 0px; height: 32px;"></div></div><div class="ace_scroller" style="left: 42px; right: 0px; bottom: 0px;"><div class="ace_content" style="margin-top: 0px; width: 482px; height: 112px; margin-left: 0px;"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 580.1px; visibility: visible;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"><div class="ace_line_group" style="height:32px"><div class="ace_line" style="height:16px"><span class="ace_keyword">def</span> <span class="ace_identifier">blur</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">src</span>: <span class="ace_identifier">Img</span>, <span class="ace_identifier">dst</span>: <span class="ace_identifier">Img</span>, <span class="ace_identifier">from</span>: <span class="ace_support ace_function">Int</span>, <span class="ace_identifier">end</span>: <span class="ace_support ace_function">Int</span>, <span class="ace_identifier">radius</span>: <span class="ace_support ace_function">Int</span><span class="ace_paren ace_rparen">)</span>: </div><div class="ace_line" style="height:16px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_support ace_function">Unit</span></div></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor" style="left: 61.61px; top: 16px; width: 7.20125px; height: 16px;"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 17px; bottom: 0px;"><div class="ace_scrollbar-inner" style="width: 17px; height: 32px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 17px; left: 42px; right: 0px;"><div class="ace_scrollbar-inner" style="height: 17px; width: 482px;"></div></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div></pre><p>The implementation of <strong>blur</strong> should rely on the previously defined <strong>boxBlurKernel</strong>.</p><p>Then, implement the <strong>parBlur</strong> method, which divides the image into<strong> numTasks</strong> vertical strips and runs each task in parallel:</p><pre contenteditable="false" data-language="scala" tabindex="0" style="opacity: 1;"><div data-reactroot="" class="rc-CodeBlock ace_editor ace-tomorrow" style="height: 50px;"><textarea class="ace_text-input" wrap="off" autocorrect="off" autocapitalize="off" spellcheck="false" style="opacity: 0; left: 474.799px; top: 0px; height: 16px; width: 7.20125px;" role="presentation" aria-hidden="true" tabindex="-1"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled" style="margin-top: 0px; height: 80px; width: 41px;"><div class="ace_gutter-cell " style="height: 16px;">1</div></div><div class="ace_gutter-active-line" style="top: 0px; height: 16px;"></div></div><div class="ace_scroller" style="left: 42px; right: 0px; bottom: 0px;"><div class="ace_content" style="margin-top: 0px; width: 482px; height: 80px; margin-left: 0px;"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 580.1px; visibility: visible;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword">def</span> <span class="ace_identifier">parBlur</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">src</span>: <span class="ace_identifier">Img</span>, <span class="ace_identifier">dst</span>: <span class="ace_identifier">Img</span>, <span class="ace_identifier">numTasks</span>: <span class="ace_support ace_function">Int</span>, <span class="ace_identifier">radius</span>: <span class="ace_support ace_function">Int</span><span class="ace_paren ace_rparen">)</span>: <span class="ace_support ace_function">Unit</span></div></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor" style="left: 472.081px; top: 0px; width: 7.20125px; height: 16px;"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 17px; bottom: 0px;"><div class="ace_scrollbar-inner" style="width: 17px; height: 16px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 17px; left: 42px; right: 0px;"><div class="ace_scrollbar-inner" style="height: 17px; width: 482px;"></div></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div></pre><p>Use Scala ranges to create a list of splitting points (hint: use the <strong>by</strong> method on ranges). Then use collection combinators on the list of splitting points to create a list of start and end tuples, one for each strip (hint: use the<strong> zip</strong> and <strong>tail </strong>methods). Finally, use the <strong>task</strong> construct to start a parallel task for each strip, and then call <strong>join</strong> on each task to wait for its completion.</p><p>Run the <strong>VerticalBoxBlur</strong> program with the following sbt command:</p><pre contenteditable="false" data-language="sh" tabindex="0" style="opacity: 1;"><div data-reactroot="" class="rc-CodeBlock ace_editor ace-tomorrow" style="height: 50px;"><textarea class="ace_text-input" wrap="off" autocorrect="off" autocapitalize="off" spellcheck="false" style="opacity: 0; left: 341.251px; top: 0px; height: 16px; width: 7.20125px;" role="presentation" aria-hidden="true" tabindex="-1"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled" style="margin-top: 0px; height: 80px; width: 41px;"><div class="ace_gutter-cell " style="height: 16px;">1</div></div><div class="ace_gutter-active-line" style="top: 0px; height: 16px;"></div></div><div class="ace_scroller" style="left: 42px; right: 0px; bottom: 0px;"><div class="ace_content" style="margin-top: 0px; width: 482px; height: 80px; margin-left: 0px;"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 580.1px; visibility: visible;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword ace_operator">&gt;</span> <span class="ace_identifier">runMain</span> <span class="ace_identifier">scalashop</span>.<span class="ace_identifier">VerticalBoxBlurRunner</span></div></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor" style="left: 299.251px; top: 0px; width: 7.20125px; height: 16px;"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 17px; bottom: 0px;"><div class="ace_scrollbar-inner" style="width: 17px; height: 16px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 17px; left: 42px; right: 0px;"><div class="ace_scrollbar-inner" style="height: 17px; width: 482px;"></div></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div></pre><p>Change the number of tasks and the radius parameter. How does the performance change?</p><h2>Horizontal Stripping Box Blur</h2><p>In this part of the exercise we will pick an alternative agglomeration for the box blur algorithm. Instead of dividing the image into vertical strips, we will divide it into horizontal strips in a similar way:</p><figure><img src="https://d3c33hcgiwev3.cloudfront.net/imageAssetProxy.v1/gzmrLdDEEeWLWxKOx1I7mw_5bd178ed5c4473f7c7ae958784789537_horizontal.png?expiry=1538524800000&amp;hmac=dwOndTDNUmcAVaqqdgjMSM8EV2GJ7EBPtdl82YNghnI" alt="" data-asset-id="gzmrLdDEEeWLWxKOx1I7mw"></figure><p>We implement the two methods, <strong>blur</strong> and <strong>parBlur</strong> in a similar way as before:</p><pre contenteditable="false" data-language="scala" tabindex="0" style="opacity: 1;"><div data-reactroot="" class="rc-CodeBlock ace_editor ace-tomorrow" style="height: 50px;"><textarea class="ace_text-input" wrap="off" autocorrect="off" autocapitalize="off" spellcheck="false" style="opacity: 0; left: 474.799px; top: 32px; height: 16px; width: 7.20125px;" role="presentation" aria-hidden="true" tabindex="-1"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled" style="margin-top: 0px; height: 96px; width: 41px;"><div class="ace_gutter-cell " style="height: 32px;">1</div><div class="ace_gutter-cell " style="height: 16px;">2</div></div><div class="ace_gutter-active-line" style="top: 32px; height: 16px;"></div></div><div class="ace_scroller" style="left: 42px; right: 0px; bottom: 0px;"><div class="ace_content" style="margin-top: 0px; width: 482px; height: 96px; margin-left: 0px;"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 580.1px; visibility: visible;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"><div class="ace_line_group" style="height:32px"><div class="ace_line" style="height:16px"><span class="ace_keyword">def</span> <span class="ace_identifier">blur</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">src</span>: <span class="ace_identifier">Img</span>, <span class="ace_identifier">dst</span>: <span class="ace_identifier">Img</span>, <span class="ace_identifier">from</span>: <span class="ace_support ace_function">Int</span>, <span class="ace_identifier">end</span>: <span class="ace_support ace_function">Int</span>, <span class="ace_identifier">radius</span>: <span class="ace_support ace_function">Int</span><span class="ace_paren ace_rparen">)</span>: </div><div class="ace_line" style="height:16px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_support ace_function">Unit</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword">def</span> <span class="ace_identifier">parBlur</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">src</span>: <span class="ace_identifier">Img</span>, <span class="ace_identifier">dst</span>: <span class="ace_identifier">Img</span>, <span class="ace_identifier">numTasks</span>: <span class="ace_support ace_function">Int</span>, <span class="ace_identifier">radius</span>: <span class="ace_support ace_function">Int</span><span class="ace_paren ace_rparen">)</span>: <span class="ace_support ace_function">Unit</span></div></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor" style="left: 472.081px; top: 32px; width: 7.20125px; height: 16px;"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 17px; bottom: 0px;"><div class="ace_scrollbar-inner" style="width: 17px; height: 48px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 17px; left: 42px; right: 0px;"><div class="ace_scrollbar-inner" style="height: 17px; width: 482px;"></div></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div></pre><p>Note that the arguments <strong>from</strong> (included) and <strong>end</strong> (excluded) this time denote the the values of the<strong> y</strong> coordinate (i.e, row indices), and that we traverse the pixels left-to-right within each strip.</p><p>You can now run the <strong>HorizontalBoxBlur</strong> program with</p><pre contenteditable="false" data-language="sh" tabindex="0" style="opacity: 1;"><div data-reactroot="" class="rc-CodeBlock ace_editor ace-tomorrow" style="height: 50px;"><textarea class="ace_text-input" wrap="off" autocorrect="off" autocapitalize="off" spellcheck="false" style="opacity: 0; left: 355.654px; top: 0px; height: 16px; width: 7.20125px;" role="presentation" aria-hidden="true" tabindex="-1"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled" style="margin-top: 0px; height: 80px; width: 41px;"><div class="ace_gutter-cell " style="height: 16px;">1</div></div><div class="ace_gutter-active-line" style="top: 0px; height: 16px;"></div></div><div class="ace_scroller" style="left: 42px; right: 0px; bottom: 0px;"><div class="ace_content" style="margin-top: 0px; width: 482px; height: 80px; margin-left: 0px;"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 580.1px; visibility: visible;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword ace_operator">&gt;</span> <span class="ace_identifier">runMain</span> <span class="ace_identifier">scalashop</span>.<span class="ace_identifier">HorizontalBoxBlurRunner</span></div></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor" style="left: 313.654px; top: 0px; width: 7.20125px; height: 16px;"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 17px; bottom: 0px;"><div class="ace_scrollbar-inner" style="width: 17px; height: 16px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 17px; left: 42px; right: 0px;"><div class="ace_scrollbar-inner" style="height: 17px; width: 482px;"></div></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div></pre><p>If you implemented the two blur versions correctly, you should observe that the horizontal stripping is slightly faster. This is because the pixel traversal order visits the pixels which are closer together in memory (remember the mapping between the pixel coordinates and the memory addresses). As a result, each core can reuse some of the pixels that it fetched from the memory during the previous invocation of <strong>boxBlurKernel</strong>. The processor cores spend less time fetching pixels from memory, and lower the pressure on the memory bus.</p><h2>ScalaShop</h2><p>Now we have everything we need to start ScalaShop:</p><pre contenteditable="false" data-language="sh" tabindex="0" style="opacity: 1;"><div data-reactroot="" class="rc-CodeBlock ace_editor ace-tomorrow" style="height: 50px;"><textarea class="ace_text-input" wrap="off" autocorrect="off" autocapitalize="off" spellcheck="false" style="opacity: 0; left: 254.836px; top: 0px; height: 16px; width: 7.20125px;" role="presentation" aria-hidden="true" tabindex="-1"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled" style="margin-top: 0px; height: 80px; width: 41px;"><div class="ace_gutter-cell " style="height: 16px;">1</div></div><div class="ace_gutter-active-line" style="top: 0px; height: 16px;"></div></div><div class="ace_scroller" style="left: 42px; right: 0px; bottom: 0px;"><div class="ace_content" style="margin-top: 0px; width: 482px; height: 80px; margin-left: 0px;"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 580.1px; visibility: visible;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword ace_operator">&gt;</span> <span class="ace_identifier">runMain</span> <span class="ace_identifier">scalashop</span>.<span class="ace_identifier">ScalaShop</span></div></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor" style="left: 212.836px; top: 0px; width: 7.20125px; height: 16px;"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 17px; bottom: 0px;"><div class="ace_scrollbar-inner" style="width: 17px; height: 16px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 17px; left: 42px; right: 0px;"><div class="ace_scrollbar-inner" style="height: 17px; width: 482px;"></div></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div></pre><p>Change the blur implementation, parallelism level and blur radius, and study the effect your changes have on performance.</p><ul><li>Which of the two blur implementations is faster?</li><li>For which values of the <strong>radius</strong> parameter is the difference most significant? Why?</li><li>What if we split the image into rectangles? Will this be faster?</li></ul><p></p><p><em>"Adobe" and "Photoshop" are either registered trademarks or trademarks of Adobe Systems Incorporated in the United States and/or other countries.</em></p><p></p><p></p><p></p><p></p></div></div>